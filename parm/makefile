# This makefile is to create Post flat file from available and control XML file

FLATFILEDIR		= /global/save/Lin.Gan/emc/post/reg_test/speedup_xml_read_v2/ush

# Target flat file
GFSFLATFILENAME		= postxconfig-NT-GFS.txt
GFSGOESFLATFILENAME	= postxconfig-NT-GFS-GOES.txt
GFSANLFLATFILENAME	= postxconfig-NT-GFS-ANL.txt
GFSF00FLATFILENAME	= postxconfig-NT-GFS-F00.txt
NMMFLATFILENAME		= postxconfig-NT-NMM.txt
NGACFLATFILENAME	= postxconfig-NT-NGAC.txt

# Source Post XML file
GFSAVAILXMLFILENAME	= post_avblflds.xml
GFSCTRLFILENAME		= postcntrl_gfs.xml
GFSGOESCTRLFILENAME	= postcntrl_gfs_goes.xml
GFSANLCTRLFILENAME	= postcntrl_gfs_anl.xml
GFSCTRLF00FILENAME	= postcntrl_gfs_f00.xml
NMMAVAILXMLFILENAME	= nam_post_avblflds.xml
NMMCTRLFILENAME		= nam_cntrl_cmaq.xml
NGACAVAILXMLFILENAME	= ngac_post_avblflds.xml
NGACCTRLFILENAME	= ngac_postcntrl.xml


# Post flat file generator
PERLXML			= PostXMLPreprocessor.pl

# CMD with param
PERLXMLGFS		= /usr/bin/perl $(PERLXML) $(GFSCTRLFILENAME) $(GFSAVAILXMLFILENAME) $(GFSFLATFILENAME)
PERLXMLGFSGOES		= /usr/bin/perl $(PERLXML) $(GFSGOESCTRLFILENAME) $(GFSAVAILXMLFILENAME) $(GFSGOESFLATFILENAME)
PERLXMLGFSANL		= /usr/bin/perl $(PERLXML) $(GFSANLCTRLFILENAME) $(GFSAVAILXMLFILENAME) $(GFSANLFLATFILENAME)
PERLXMLGFSF00		= /usr/bin/perl $(PERLXML) $(GFSCTRLF00FILENAME) $(GFSAVAILXMLFILENAME) $(GFSF00FLATFILENAME)
PERLXMLNMM		= /usr/bin/perl $(PERLXML) $(NMMCTRLFILENAME) $(NMMAVAILXMLFILENAME) $(NMMFLATFILENAME)
PERLXMLNGAC		= /usr/bin/perl $(PERLXML) $(NGACCTRLFILENAME) $(NGACAVAILXMLFILENAME) $(NGACFLATFILENAME)


# File to look for change
GFSXMLS = $(GFSAVAILXMLFILENAME) $(GFSCTRLFILENAME)
GFSGOESXMLS = $(GFSAVAILXMLFILENAME) $(GFSGOESCTRLFILENAME)
GFSANLXMLS = $(GFSAVAILXMLFILENAME) $(GFSANLCTRLFILENAME)
GFSF00XMLS = $(GFSAVAILXMLFILENAME) $(GFSCTRLF00FILENAME)
NMMXMLS = $(NMMAVAILXMLFILENAME) $(NMMCTRLFILENAME)
NGACXMLS = $(NGACAVAILXMLFILENAME) $(NGACCTRLFILENAME)

# If action is triggered; run the following
all: $(GFSFLATFILENAME) $(GFSGOESFLATFILENAME) $(GFSANLFLATFILENAME) $(GFSF00FLATFILENAME) $(NMMFLATFILENAME) $(NGACFLATFILENAME)
$(GFSFLATFILENAME): $(GFSXMLS)
	$(PERLXMLGFS)
$(GFSGOESFLATFILENAME): $(GFSGOESXMLS)
	$(PERLXMLGFSGOES)
$(GFSANLFLATFILENAME): $(GFSANLXMLS)
	$(PERLXMLGFSANL)
$(GFSF00FLATFILENAME): $(GFSF00XMLS)
	$(PERLXMLGFSF00)
$(NMMFLATFILENAME): $(NMMXMLS)
	$(PERLXMLNMM)
$(NGACFLATFILENAME): $(NGACXMLS)
	$(PERLXMLNGAC)

clean:
	/bin/rm -f $(GFSFLATFILENAME) $(GFSGOESFLATFILENAME) $(GFSANLFLATFILENAME) $(GFSF00FLATFILENAME) $(NMMFLATFILENAME) $(NGACFLATFILENAME)
